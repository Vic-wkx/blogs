æœˆåœ†ä¹‹å¤œï¼Œæ´›æ´›å±±ã€‚

æ´›æ´›å±±åè½äºå¤šçº¿ç¨‹ç‹å›½çš„ä¸€ä¸ªåè¿œå°é•‡ï¼Œå±±ä¸Šç»¿æ ‘ç¯ç»•ï¼Œé£å…‰çµç§€ã€‚è¸ç€èœ¿èœ’çš„å°è·¯å¾ªè¿¹è€Œä¸Šï¼ŒèŠ±é¦™ã€é¸Ÿå•¼ã€é’æŸ³ã€è™«é¸£ï¼Œå…±åŒæ¼”å¥è€…ä¸€æ›²å¤©åœ°ä¹‹æ­Œï¼Œå¤§è‡ªç„¶çš„é¬¼æ–§ç¥å·¥å’Œæ´›æ´›å±±å¤§å½“å®¶å¼ éº»å­çš„ç¬‘å£°ä¸€æ ·è±ªæ”¾ä¸ç¾ã€‚å¼ éº»å­å é¢†æ´›æ´›å±±åå¹´æœ‰ä½™ï¼Œå¯¨å­åˆ›ç«‹ä¹‹åˆï¼Œä»–ä¾¿å®šä¸‹è§„çŸ©ï¼šâ€œä¸‰ä¸åŠ«â€â€”â€”è€å°‘ä¸åŠ«ã€å†œæ°‘ä¸åŠ«ã€å¦‡äººä¸åŠ«ã€‚åªå¯¹è·¯è¿‡çš„å¯Œå•†ã€å®˜å®¦ç­‰æœ‰é’±æœ‰åŠ¿çš„äººå®¶ä¸‹æ‰‹ï¼Œæ”¶å–è¿‡è·¯è´¹ç”¨ã€‚åœ¨ä»–å¤šå¹´ç”¨å¿ƒç»è¥ä¹‹ä¸‹ï¼Œå¯¨å­å·²å°æœ‰è§„æ¨¡ã€‚å¯¨ä¸­å£®ä¸ä¸Šåƒè®¸ï¼Œåº“å†…é…’é’±ä¸Šä¸‡è´¯ã€‚å¼ éº»å­ä½œä¸ºå¤§å½“å®¶ï¼Œæ­£æ˜¯æ„æ°”é£å‘ä¹‹æ—¶ï¼Œé—®è‹èŒ«å¤§åœ°ï¼Œæˆ‘ä¸»æ²‰æµ®ï¼ç»ˆæ—¥é¥®é…’ä½œä¹ï¼Œå¥½ä¸å¿«æ´»ã€‚

äººåˆ°æ— æ±‚å“è‡ªé«˜ï¼Œå¼ éº»å­åœ¨æ´›æ´›å±±åŠ¿åŠ›è¶³å¤Ÿå¤§æ—¶ï¼Œä¾¿å¾ˆå°‘å†ç®¡æŸå¯¨å­ä¸­çš„äº‹ï¼Œæ¸æ¸åœ°ä»»å…¶è‡ªç”±ç”Ÿé•¿ã€‚æ´›æ´›å±±çš„æ‰‹ä¸‹ä»¬é•¿æœŸè¿‡ç€ä¼˜æ¸¥çš„ç”Ÿæ´»ï¼Œä¸å…æ²¾æŸ“ä¸Šäº›çº¨ç»”ä¹‹æ°”ã€‚å¯¨å­ä»æœ€å¼€å§‹çš„åŠ«å¯Œæµè´«å‘å±•åˆ°åæ¥ï¼Œåå€’æˆäº†ä¸€æ–¹æ¶éœ¸ï¼Œæ‰‹ä¸‹çš„äººä¸è§„çŸ©ï¼Œè€å°‘åŠ«ã€å†œæ°‘åŠ«ã€å¦‡äººä¹ŸåŠ«ï¼Œé•‡ä¸Šäººæ°‘è‹¦ä¸å ªè¨€ã€‚å¼ éº»å­æœ¬äººå´è¶Šæ¥è¶Šä¸é—®ä¸–äº‹ï¼Œå¿ƒæ€€é€šè¾¾ï¼Œè§åˆ°è°éƒ½æ˜¯æ»¡é¢ç¬‘å®¹ï¼Œè®©äººå¦‚æ²æ˜¥é£ä¹‹ä¸­ã€‚

ä¸è¿‡ï¼Œåœ¨ä½ çœ¼é‡Œå¼ éº»å­çš„ç¬‘å°±ä¸æ˜¯é‚£ä¹ˆè®©äººæ¬¢å–œäº†ã€‚ç”·å„¿ä½•ä¸å¸¦å´é’©ï¼Ÿä½œä¸ºä¸€åæœ‰å¿—é’å¹´ï¼Œä½ ä¹Ÿæ›¾çºµé©¬æ¨ªåˆ€ï¼Œå†³å¿ƒå å±±ä¸ºç‹ã€‚ç„¶è€Œç»ˆæ•Œä¸è¿‡æ´›æ´›å±±ä¼ æ‰¿å·²ä¹…ï¼Œåº•è•´æ·±åšã€‚æœ€ç»ˆä½ åªèƒ½åœ¨æ¬¡ä¸€ç­‰çš„çš®çš®å±±å®‰è¥æ‰å¯¨ï¼Œçš®çš®å±±åœ°åŠ¿é™©å³»ï¼Œæ˜“å®ˆéš¾æ”»ã€‚ç‰©äº§åˆæå…¶åŒ®ä¹ï¼Œå¼ éº»å­ä¸å±‘äºä¸ºçš®çš®å±±ä¸Šçš„è‡å¤´å°åˆ©å¤§åŠ¨å¹²æˆˆï¼Œè¿™äº›å¹´æ¥ï¼Œä¸¤åº§å±±å¤´å€’ä¹Ÿç›¸å®‰æ— äº‹ã€‚

ç„¶è€Œå±±çæµ·å‘³æ‘†åœ¨çœ¼å‰ï¼Œè°åˆèƒ½å°†å°±å¾—äº†å’¸èœèåœã€‚ä½ æ—©å·²åœ¨å¿ƒä¸­æš—æš—å‘èª“ï¼ŒåŠ¿å¿…å é¢†æ´›æ´›å±±å¤´ï¼æ­£å€¼åäº”æœˆåœ†å¤œï¼Œè°‹äº‹æœˆé»‘é£é«˜æ—¶ã€‚ä½ ç‡é¢†æ‰‹ä¸‹å…«ç™¾ä½™äººæ‚„ç„¶å›´æ”»æ´›æ´›å±±ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©åäº”æ˜¯å› ä¸ºä½ çŸ¥é“æœˆå„¿è¶Šæ˜ï¼Œæ˜Ÿæ˜Ÿè¶Šç¨€å°‘ï¼Œè‹¥å†é‡ä¸Šä¹Œäº‘é®è”½æœˆè‰²ï¼Œç«¯çš„æ˜¯ä¼¸æ‰‹ä¸è§äº”æŒ‡ï¼Œæ­£æ˜¯åŠ¨æ‰‹çš„å¥½æ—¶æœºã€‚ä½ å†³å®šè¶ç€ä»Šå¤œäº‘è’¸é›¾ç»•ï¼Œå¯¹æ´›æ´›å±±å‘åŠ¨æ€»æ”»ã€‚

æ´›æ´›å±±è¥¿è¾¹èƒŒé æ‚¬å´–ï¼Œæœ€æ˜¯é™©å³»ã€‚ä½ æ´¾å‡ºå…­æŒ‡ã€éº»è¢‹ã€å°ä¸œè¥¿ä¸‰åå¿ƒè…¹ç‡äººåˆ†åˆ«å›´ä½ä¸œã€å—ã€åŒ—ä¸‰ä¸ªæ–¹å‘ï¼Œä½ äº²è‡ªå¸¦é¢†ä¸€æ‰¹ç§˜å¯†åŸ¹å…»çš„ç²¾è‹±éƒ¨é˜Ÿä»è¥¿é¢æ‚¬å´–æ”€æ´è€Œä¸Šï¼Œå†³å¿ƒæ‰“ä»–å¼ éº»å­ä¸€ä¸ªé‡œåº•æŠ½è–ªã€‚

â€œå…­æŒ‡ï¼Œæˆ‘ç‡é¢†éƒ¨é˜Ÿå…ˆçˆ¬ä¸Šè¥¿é¢æ‚¬å´–ï¼Œè›°ä¼åœ¨è‰ä¸›ä¸­ã€‚å¾…æˆ‘å‡†å¤‡å¥½ä¹‹åï¼Œæˆ‘ä¼šç»™ä½ å‘å‡ºä¿¡å·ã€‚ä¸€ä¼šä½ æ”¶åˆ°æˆ‘ç»™ä½ çš„ä¿¡å·åï¼Œå…ˆä»ä¸œè¾¹ä½¯æ”»å¸å¼•ç«åŠ›ï¼Œä¸æ±‚æ€æ•Œæ•°é‡ï¼Œä½†ä¸€å®šè¦æŠŠå£°åŠ¿æå¤§ï¼Œå¹¶å°½å¯èƒ½å‡å°‘å¼Ÿå…„ä»¬çš„ä¼¤äº¡ã€‚æ´›æ´›å±±æ­¤æ—¶æ²¡æœ‰é˜²å¤‡ï¼Œæ…Œä¹±ä¸­å¿…å®šæ´¾å‡ºå¤§éƒ¨é˜Ÿè¿æˆ˜ï¼Œä½ åªè¦æ‹–ä½æ´›æ´›å±±ä¸Šçš„å¤§éƒ¨é˜Ÿååˆ†é’Ÿå³å¯ã€‚å¾…å¤§éƒ¨åˆ†æ•Œäººåˆ°ä½ é‚£é‡Œä¹‹åï¼Œä½ ç»™éº»è¢‹ã€å°ä¸œè¥¿ä¸€äººä¸€ä¸ªä¿¡å·ï¼Œéº»è¢‹å’Œå°ä¸œè¥¿æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œä»å—åŒ—ä¸¤é¢å†²ä¸Šå»ï¼Œæˆ‘ä¼šåœ¨è¥¿é¢é…åˆä½ ä»¬ã€‚è¿™æ¬¡ï¼Œå’±ä»¬ä¸€å®šè¦ä¸€å£æ°”ç«¯äº†å¼ éº»å­çš„è€å·¢ï¼â€

å…­æŒ‡ï¼šâ€œå¤§å“¥ï¼Œå…­æŒ‡æ”¶åˆ°ï¼è¥¿é¢å‡¶é™©ï¼Œå¤§å“¥ä¸€å®šè¦å¥½ç”Ÿå°å¿ƒï¼â€

éº»è¢‹ï¼šâ€œéº»è¢‹æ”¶åˆ°ï¼Œå—é¢äº¤ç»™æˆ‘ï¼Œæˆ‘ä¸€å®šæ€ä»–ä»¬ä¸ªç‰‡ç”²ä¸ç•™ï¼â€

å°ä¸œè¥¿ï¼šâ€œ...â€

â€œå°ä¸œè¥¿ï¼Œä½ é‚£è¾¹æ€ä¹ˆæ ·ï¼Ÿâ€

å°ä¸œè¥¿ï¼šâ€œè€å¤§...æŠ±æ­‰ï¼Œæˆ‘æ²¡æ€ä¹ˆå¬æ˜ç™½ï¼Œå¤ªå¤šä¿¡å·äº†ï¼Œæˆ‘è„‘å­æœ‰ç‚¹ä¹±äº†ã€‚â€

â€œæˆ‘å†ç»™ä½ ä»¬è§£é‡Šä¸€éï¼Œæˆ‘å’Œæˆ‘å¸¦é¢†çš„éƒ¨é˜Ÿä¼šå…ˆçˆ¬ä¸Šè¥¿é¢æ‚¬å´–ï¼Œå…­æŒ‡ã€éº»è¢‹å’Œå°ä¸œè¥¿ä½ ä»¬ä¸‰ä¸ªå…ˆåœ¨ä¸‰é¢è›°ä¼ï¼Œä½ ä»¬æ¯ä¸ªäººéƒ½éœ€è¦æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ‰è¡ŒåŠ¨ã€‚æˆ‘çˆ¬ä¸Šæ‚¬å´–åï¼Œä¼šç»™å…­æŒ‡ä¸€ä¸ªä¿¡å·ï¼Œå…­æŒ‡æ”¶åˆ°ä¿¡å·åå¼€å§‹ä»ä¸œè¾¹ä½¯æ”»å¸å¼•ç«åŠ›ã€‚ç­‰ç«åŠ›è¢«å¸å¼•è¿‡å»åï¼Œå…­æŒ‡ç»™éº»è¢‹å’Œå°ä¸œè¥¿ä¸€äººä¸€ä¸ªä¿¡å·ï¼Œè¿™æ—¶éº»è¢‹å’Œå°ä¸œè¥¿ä½ ä»¬ä¸¤ä¸ªå†ä»å—åŒ—ä¸¤é¢è¡ŒåŠ¨ï¼Œæˆ‘ä¼šåœ¨è¥¿é¢å’Œä½ ä»¬é‡Œåº”å¤–åˆã€‚å¬æ˜ç™½äº†å—ï¼Ÿâ€

å…­æŒ‡ï¼šâ€œè€å¤§ï¼Œæ˜ç™½äº†ï¼â€

éº»è¢‹ï¼šâ€œè€å¤§ï¼Œæ˜ç™½äº†ï¼â€

å°ä¸œè¥¿ï¼šâ€œ...â€

â€œå°ä¸œè¥¿ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿâ€

å°ä¸œè¥¿ï¼šâ€œè€å¤§ï¼Œæˆ‘ä»¥å‰æ˜¯ä¸ªç ´å†™ä»£ç çš„ï¼Œæˆ‘æ•²äº†ä¸€ä»½ä¼ªä»£ç ï¼Œä½ çœ‹ä¸‹æ˜¯ä¸æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬å››ä¸ªéƒ¨é˜Ÿå°±åƒå››ä¸ªçº¿ç¨‹ä¸€æ ·ã€‚â€

ä½ æ‹¿è¿‡å°ä¸œè¥¿é€’è¿‡æ¥çš„é«˜ç«¯è½»å¥¢ç¬”è®°æœ¬ Macbook Proï¼Œçœ‹åˆ°å°ä¸œè¥¿å†™äº†ä¸€ä»½è¿™æ ·çš„ä»£ç ï¼š

```java
public class Fighting {

    public static void main(String[] args) {
        new Thread(() -> {
            // è€å¤§çš„çº¿ç¨‹
            boss();
        }).start();
        new Thread(() -> {
            // å…­æŒ‡çš„çº¿ç¨‹
            sixFingers();
        }).start();
        new Thread(() -> {
            // éº»è¢‹çš„çº¿ç¨‹
            bag();
        }).start();
        new Thread(() -> {
            // å°ä¸œè¥¿çš„çº¿ç¨‹
            smallThing();
        }).start();
    }

    private static void boss() {
        System.out.println("è€å¤§ç‡é¢†éƒ¨é˜Ÿæ­£åœ¨æ´›æ´›å±±è¥¿é¢çˆ¬æ‚¬å´–...");
        // æ¨¡æ‹Ÿçˆ¬æ‚¬å´–è€—æ—¶
        Thread.sleep(1000);
        System.out.println("è€å¤§çˆ¬ä¸Šäº†è¥¿é¢å±±å¤´ï¼");
        è€å¤§ç»™å…­æŒ‡ä¸€ä¸ªä¿¡å·ï¼Œé€šçŸ¥å…­æŒ‡è¡ŒåŠ¨
    }

    private static void sixFingers() {
        å…­æŒ‡æ­£åœ¨ç­‰å¾…ä¿¡å·ï¼Œæ”¶åˆ°ä¿¡å·åæ‰å¼€å§‹æ‰§è¡Œä¸‹é¢çš„æ“ä½œ
        System.out.println("å…­æŒ‡æ”¶åˆ°äº†ä¿¡å·ï¼Œå¼€å§‹ä½¯æ”»ï¼");
        // æ¨¡æ‹Ÿä½¯æ”»å¸å¼•ç«åŠ›è€—æ—¶
        Thread.sleep(1000);
        System.out.println("æ´›æ´›å±±å¤§éƒ¨é˜Ÿå·²è¢«å¸å¼•è¿‡æ¥ï¼");
        å…­æŒ‡ç»™éº»è¢‹ä¸€ä¸ªä¿¡å·
        å…­æŒ‡ç»™å°ä¸œè¥¿ä¸€ä¸ªä¿¡å·
    }

    private static void bag() {
        éº»è¢‹æ­£åœ¨ç­‰å¾…ä¿¡å·ï¼Œæ”¶åˆ°ä¿¡å·åæ‰å¼€å§‹æ‰§è¡Œä¸‹é¢çš„æ“ä½œ
        System.out.println("éº»è¢‹æ”¶åˆ°äº†ä¿¡å·ï¼Œä»å—é¢å†²ä¸Šå»ï¼");
    }

    private static void smallThing() {
        å°ä¸œè¥¿æ­£åœ¨ç­‰å¾…ä¿¡å·ï¼Œæ”¶åˆ°ä¿¡å·åæ‰å¼€å§‹æ‰§è¡Œä¸‹é¢çš„æ“ä½œ
        System.out.println("å°ä¸œè¥¿æ”¶åˆ°äº†ä¿¡å·ï¼Œä»åŒ—é¢å†²ä¸Šå»ï¼");
    }
}
```

â€œæ²¡é”™ï¼Œæˆ‘ä»¬çš„è®¡åˆ’å°±æ˜¯è¿™æ ·çš„ï¼Œä½†ä½ ä¸«çš„å½“åˆä¿¡å·é‡æ²¡å­¦å¥½å§ï¼Œè¿˜è¦é ä¼ªä»£ç ã€‚è¿™ç©æ„å„¿ç”¨ä¿¡å·é‡å†™å°±å¯ä»¥äº†ã€‚ä¿¡å·é‡åœ¨ Java ä¸­å¯¹åº” Semaphore ç±»ï¼Œæ­£åœ¨ç­‰å¾…ä¿¡å·å°±æ˜¯ acquire() æ–¹æ³•ï¼Œç»™åˆ«äººå‘é€ä¿¡å·å°±æ˜¯ release() æ–¹æ³•ã€‚è®©æˆ‘æ¥ç»™ä½ æ”¹æˆçœŸå®ä»£ç ã€‚â€

ä½ ç«¯ç€ç”µè„‘ï¼Œå™¼é‡Œå•ªå•¦æ•²å‡ºäº†ä¸‹é¢çš„ä»£ç ã€‚

```java
public class Fighting {
    // ç»™å…­æŒ‡çš„ä¿¡å·
    private static Semaphore semaphoreToSixFingers = new Semaphore(0);
    // ç»™éº»è¢‹çš„ä¿¡å·
    private static Semaphore semaphoreToBag = new Semaphore(0);
    // ç»™å°ä¸œè¥¿çš„ä¿¡å·
    private static Semaphore semaphoreToSmallThing = new Semaphore(0);

    public static void main(String[] args) {
        new Thread(() -> {
            try {
                // è€å¤§çš„çº¿ç¨‹
                boss();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();
        new Thread(() -> {
            try {
                // å…­æŒ‡çš„çº¿ç¨‹
                sixFingers();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();
        new Thread(() -> {
            try {
                // éº»è¢‹çš„çº¿ç¨‹
                bag();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();
        new Thread(() -> {
            try {
                // å°ä¸œè¥¿çš„çº¿ç¨‹
                smallThing();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();
    }

    private static void boss() throws InterruptedException {
        System.out.println("è€å¤§ç‡é¢†éƒ¨é˜Ÿæ­£åœ¨æ´›æ´›å±±è¥¿é¢çˆ¬æ‚¬å´–...");
        Thread.sleep(1000);
        System.out.println("è€å¤§çˆ¬ä¸Šäº†è¥¿é¢å±±å¤´ï¼");
        System.out.println("è€å¤§ç»™å…­æŒ‡ä¸€ä¸ªä¿¡å·");
        semaphoreToSixFingers.release();
    }

    private static void sixFingers() throws InterruptedException {
        semaphoreToSixFingers.acquire();
        System.out.println("å…­æŒ‡æ”¶åˆ°äº†ä¿¡å·ï¼Œå¼€å§‹ä½¯æ”»ï¼");
        Thread.sleep(1000);
        System.out.println("æ´›æ´›å±±å¤§éƒ¨é˜Ÿå·²è¢«å¸å¼•è¿‡æ¥ï¼");
        System.out.println("å…­æŒ‡ç»™éº»è¢‹å’Œå°ä¸œè¥¿ä¸€äººä¸€ä¸ªä¿¡å·");
        semaphoreToBag.release();
        semaphoreToSmallThing.release();
    }

    private static void bag() throws InterruptedException {
        semaphoreToSmallThing.acquire();
        System.out.println("éº»è¢‹æ”¶åˆ°äº†ä¿¡å·ï¼Œä»å—é¢å†²ä¸Šå»ï¼");
    }

    private static void smallThing() throws InterruptedException {
        semaphoreToBag.acquire();
        System.out.println("å°ä¸œè¥¿æ”¶åˆ°äº†ä¿¡å·ï¼Œä»åŒ—é¢å†²ä¸Šå»ï¼");
    }
}
```

è¿è¡Œç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š

```shell
è€å¤§ç‡é¢†éƒ¨é˜Ÿæ­£åœ¨æ´›æ´›å±±è¥¿é¢çˆ¬æ‚¬å´–...
è€å¤§çˆ¬ä¸Šäº†è¥¿é¢å±±å¤´ï¼
è€å¤§ç»™å…­æŒ‡ä¸€ä¸ªä¿¡å·

å…­æŒ‡æ”¶åˆ°äº†ä¿¡å·ï¼Œå¼€å§‹ä½¯æ”»ï¼
æ´›æ´›å±±å¤§éƒ¨é˜Ÿå·²è¢«å¸å¼•è¿‡æ¥ï¼
å…­æŒ‡ç»™éº»è¢‹å’Œå°ä¸œè¥¿ä¸€äººä¸€ä¸ªä¿¡å·

éº»è¢‹æ”¶åˆ°äº†ä¿¡å·ï¼Œä»å—é¢å†²ä¸Šå»ï¼

å°ä¸œè¥¿æ”¶åˆ°äº†ä¿¡å·ï¼Œä»åŒ—é¢å†²ä¸Šå»ï¼
```

 å°ä¸œè¥¿ï¼šâ€œè€å¤§ğŸ‚ğŸºï¼æˆ‘æ˜ç™½äº†ï¼â€

â€œä¿¡å·é‡å°±æ˜¯ç”¨æ¥æ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºçš„ï¼Œä¸ä¼šç”¨çš„è¯å›å»å¥½å¥½ç»ƒç»ƒå»ï¼â€

å°ä¸œè¥¿ï¼šâ€œè€å¤§ï¼Œæˆ‘ä¹Ÿæƒ³ç»ƒå•Šï¼Œå¯æ˜¯æˆ‘ä¸çŸ¥é“åœ¨å“ªé‡Œç»ƒä¹ ï¼Œå’±å¹³æ—¶æ‰“å®¶åŠ«èˆä¹Ÿè§ä¸åˆ°ã€‚â€

â€œåŠ›æ‰£ä¸Šä¸æ˜¯æœ‰å¤šçº¿ç¨‹çš„é¢˜å—ï¼Ÿä½ å»åˆ·ä¸€éå°±ä¼šäº†ã€‚â€

è¯´ç€ä½ ä»¬æ‰“å¼€äº†[åŠ›æ‰£å®˜ç½‘](https://leetcode-cn.com/)ï¼Œåœ¨`é¢˜åº“`ä¸­ç‚¹å¼€äº†`å¤šçº¿ç¨‹`é¢˜ï¼š[https://leetcode-cn.com/problemset/concurrency/](https://leetcode-cn.com/problemset/concurrency/)

â€œæˆ‘ç»™ä½ è®²ä¸€é“ç®€å•é¢˜å’Œä¸€é“ä¸­ç­‰é¢˜ï¼Œå…¶ä»–é¢˜ä½ å›å»æ…¢æ…¢ç»ƒã€‚â€

---

#### [1114. æŒ‰åºæ‰“å°](https://leetcode-cn.com/problems/print-in-order/)

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç±»ï¼š

```java
public class Foo {
  public void one() { print("one"); }
  public void two() { print("two"); }
  public void three() { print("three"); }
}
```


ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª Foo å®ä¾‹ã€‚

çº¿ç¨‹ A å°†ä¼šè°ƒç”¨ one() æ–¹æ³•
çº¿ç¨‹ B å°†ä¼šè°ƒç”¨ two() æ–¹æ³•
çº¿ç¨‹ C å°†ä¼šè°ƒç”¨ three() æ–¹æ³•
è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ two() æ–¹æ³•åœ¨ one() æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œï¼Œthree() æ–¹æ³•åœ¨ two() æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œã€‚

---

è¿™æ˜¯ä¸€é“ç®€å•é¢˜ï¼Œåˆ†æé¢˜ç›®å¯çŸ¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªä¿¡å·é‡å°±å¯ä»¥å®Œæˆäº†ã€‚

* å…ˆè®©æ‰“å° "two" å’Œæ‰“å° "three" çš„çº¿ç¨‹ç­‰å¾…ä¿¡å·
* "one" æ‰“å°å®Œæˆåï¼Œé€šçŸ¥ "two" å¼€å§‹æ‰“å°
* "two" æ‰“å°å®Œæˆåï¼Œé€šçŸ¥ "three" å¼€å§‹æ‰“å°

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```python
import threading

class Foo:

    def __init__(self):
        self.sem2 = threading.Semaphore(0)
        self.sem3 = threading.Semaphore(0)


    def first(self, printFirst: 'Callable[[], None]') -> None:
        printFirst()
        # é€šçŸ¥ two å¼€å§‹æ‰“å°
        self.sem2.release()


    def second(self, printSecond: 'Callable[[], None]') -> None:
        # ç­‰å¾…ä¿¡å·
        self.sem2.acquire()
        printSecond()
        # é€šçŸ¥ three å¼€å§‹æ‰“å°
        self.sem3.release()


    def third(self, printThird: 'Callable[[], None]') -> None:
        # ç­‰å¾…ä¿¡å·
        self.sem3.acquire()
        printThird()
```

---

#### [1115. äº¤æ›¿æ‰“å°FooBar](https://leetcode-cn.com/problems/print-foobar-alternately/)

æˆ‘ä»¬æä¾›ä¸€ä¸ªç±»ï¼š

```java
class FooBar {
  public void foo() {
    for (int i = 0; i < n; i++) {
      print("foo");
    }
  }

  public void bar() {
    for (int i = 0; i < n; i++) {
      print("bar");
    }
  }
}
```

ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª `FooBar` å®ä¾‹ã€‚å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ `foo()` æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ `bar()` æ–¹æ³•ã€‚

è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ "foobar" è¢«è¾“å‡º n æ¬¡ã€‚

---

è¿™æ˜¯ä¸€é“ä¸­ç­‰é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶ "foo"ã€"bar" çš„è¾“å‡ºé¡ºåºï¼Œæ€è€ƒä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä»ç„¶åªéœ€è¦ä½¿ç”¨ä¸¤ä¸ªä¿¡å·é‡ã€‚

* å…ˆè®©æ‰“å° "bar" çš„çº¿ç¨‹ç­‰å¾…ä¿¡å·
* æ‰“å° "foo" å®Œæˆåï¼Œé€šçŸ¥ "bar" å¼€å§‹æ‰“å°ï¼Œç„¶åæ‰“å° "foo" çš„çº¿ç¨‹ç­‰å¾…ä¿¡å·
* æ‰“å° "bar" å®Œæˆåï¼Œé€šçŸ¥ "foo" å¼€å§‹æ‰“å°ï¼Œç„¶åæ‰“å° "bar" çš„çº¿ç¨‹ç­‰å¾…ä¿¡å·
* è¿™æ ·äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°è¾“å‡º n æ¬¡ "foobar"

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```java
import java.util.concurrent.Semaphore;

class FooBar {
    private int n;
    private Semaphore semFoo = new Semaphore(0);
    private Semaphore semBar = new Semaphore(0);

    public FooBar(int n) {
        this.n = n;
    }

    public void foo(Runnable printFoo) throws InterruptedException {

        for (int i = 0; i < n; i++) {
            // printFoo.run() outputs "foo". Do not change or remove this line.
            printFoo.run();
            // é€šçŸ¥ "bar" å¼€å§‹æ‰“å°
            semBar.release();
            // ç­‰å¾…ä¿¡å·
            semFoo.acquire();
        }
    }

    public void bar(Runnable printBar) throws InterruptedException {

        for (int i = 0; i < n; i++) {
            // ç­‰å¾…ä¿¡å·
            semBar.acquire();
            // printBar.run() outputs "bar". Do not change or remove this line.
            printBar.run();
            // é€šçŸ¥ "foo" å¼€å§‹æ‰“å°
            semFoo.release();
        }
    }
}
```

â€œå°±æ˜¯è¿™æ ·ï¼Œå…¶ä»–çš„å¤šçº¿ç¨‹é¢˜ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªè¦ç”¨ä¿¡å·é‡å°±å¯ä»¥è½»æ¾è§£å†³ã€‚â€

å°ä¸œè¥¿ï¼šâ€œè€å¤§ï¼Œåˆå§‹åŒ–çš„ä»£ç é‡Œï¼Œ `new Semaphore(0)` é‡Œé¢çš„ 0 æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿâ€

â€œæ„æ€å°±æ˜¯åˆå§‹çš„æ—¶å€™æœ‰å¤šå°‘ä¸ªä¿¡å·ï¼Œå¦‚æœå·²ç»æœ‰è‡³å°‘ 1 ä¸ªä¿¡å·ï¼Œacquire() æ–¹æ³•å°±æ— éœ€ç­‰å¾…ï¼Œè€Œæ˜¯ç›´æ¥æ¶ˆè€—ä¸€ä¸ªä¿¡å·ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´æ¯è°ƒç”¨ä¸€æ¬¡ release() æ–¹æ³•ï¼Œå°±ä¼šæ·»åŠ ä¸€ä¸ªä¿¡å·ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ acquire() æ–¹æ³•ï¼Œå°±ä¼šå‡å°‘ä¸€ä¸ªä¿¡å·ã€‚å½“ä¿¡å·æ•°é‡ä¸º 0 æ—¶ï¼Œacquire() æ–¹æ³•å°±ä¼šç­‰å¾…ã€‚æ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¹Ÿå¯ä»¥æ”¹å†™æˆä¸‹é¢è¿™æ ·ï¼Œæ˜¾å¾— foo æ–¹æ³•å’Œ bar æ–¹æ³•çš„æ ¼å¼çœ‹èµ·æ¥æ›´åŠ ç»Ÿä¸€ã€‚â€

```java
class FooBar {
    private int n;
    // åˆå§‹æ—¶æœ‰ä¸€ä¸ª Foo ä¿¡å·
    private Semaphore semFoo = new Semaphore(1);
    private Semaphore semBar = new Semaphore(0);

    public FooBar(int n) {
        this.n = n;
    }

    public void foo(Runnable printFoo) throws InterruptedException {
        for (int i = 0; i < n; i++) {
            // ç­‰å¾…ä¿¡å·ï¼Œç¬¬ä¸€æ¬¡çš„æ—¶å€™ï¼Œå› ä¸ºå·²ç»æœ‰ä¸€ä¸ª Foo ä¿¡å·ï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥æ¶ˆè€—ä¸€ä¸ªä¿¡å·ï¼Œç»§ç»­æ‰§è¡Œ
            semFoo.acquire();
            // printFoo.run() outputs "foo". Do not change or remove this line.
            printFoo.run();
            // é€šçŸ¥ "bar" å¼€å§‹æ‰“å°
            semBar.release();
        }
    }

    public void bar(Runnable printBar) throws InterruptedException {
        for (int i = 0; i < n; i++) {
            // ç­‰å¾…ä¿¡å·
            semBar.acquire();
            // printBar.run() outputs "bar". Do not change or remove this line.
            printBar.run();
            // é€šçŸ¥ "foo" å¼€å§‹æ‰“å°
            semFoo.release();
        }
    }
}
```



å°ä¸œè¥¿ï¼šâ€œè¿™æ¬¡æˆ‘æ˜¯çœŸå¬æ˜ç™½äº†ï¼ä¿¡å·é‡çœŸæ˜¯è§£å†³å¤šçº¿ç¨‹é—®é¢˜çš„åˆ©å™¨ï¼Œè°¢è°¢è€å¤§ï¼â€

â€œä½ ä¸«çš„å›å»ä¸€å®šè¦æŠŠå¤šçº¿ç¨‹çš„é¢˜ç›®å¥½å¥½ç»ƒå®Œï¼â€

